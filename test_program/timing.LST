C51 COMPILER V8.09   TIMING                                                                07/23/2009 15:03:50 PAGE 1   


C51 COMPILER V8.09, COMPILATION OF MODULE TIMING
OBJECT MODULE PLACED IN timing.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE timing.c LARGE BROWSE INTVECTOR(0X2000) DEFINE(MONITOR51) DEBUG OBJECTEXTEN
                    -D

line level    source

   1          
   2          /*******************************************************
   3           **  Mikroprozessorlabor                              **
   4           **                                                   **
   5           **  Institut für Betriebssysteme und Rechnerverbund  **
   6           **  Technische Universität Braunschweig              **
   7           *******************************************************/
   8          
   9          // File :  timing.c 
  10          // Modul:  Nähere Bezeichnung des Projektes oder Teilprojektes
  11          // Vers.:  x.yy
  12          // Autor:  Name, Vorname 
  13          
  14          // Letzte Änderung: 2004.11.05.
  15          //*****************************
  16          
  17          
  18          
  19          // ----- Includes -----
  20          //=====================
  21          
  22          #include "timing.h"
  23          #include "lcd.h"
  24          #include <REG552.H>    
  25          
  26          // ----- Definitionen -----
  27          // ========================
  28          
  29          extern TimerStatus xdata condTimerStatus;
  30          
  31          // ----- Deklarationen, die nur innerhalb dieser Datei gebraucht werden -----
  32          // ==========================================================================
  33          
  34          unsigned int wait_ms_max = 1;
  35          unsigned int wait_ms_current = 0;
  36          
  37          /** Wartet 100 Mikrosekunden. */
  38          void usleep100();
  39          
  40          // ----- Funktionsdefinitionen -----
  41          // =================================
  42          
  43          void init_timer0() {
  44   1              TR0 = 0;       // switch off timer
  45   1              EA = 1;        // enable interrupts
  46   1              ET0 = 1;       // enable timer interrupt
  47   1              TMOD = (TMOD & 0xf0) | 0x01; // set timer mode
  48   1              TH0 = 0xfc;    // let timer count 922 clicks
  49   1              TL0 = 0x65;    // ^^
  50   1              TR0 = 1;       // switch on timer
  51   1      }
  52          
  53          void int_timer0() interrupt 1 {
  54   1              if ((++wait_ms_current) >= wait_ms_max) {
C51 COMPILER V8.09   TIMING                                                                07/23/2009 15:03:50 PAGE 2   

  55   2                      TR0 = 0;
  56   2                      ET0 = 0;
  57   2                      wait_ms_current = 0;
  58   2                      condTimerStatus = TIMER_REACHED;
  59   2                      //lcd_print_string("TIMER FINITO");
  60   2              }
  61   1              else {
  62   2                      TR0 = 0;       // switch off timer
  63   2                      TH0 = 0xfc;    // let timer count 922 clicks
  64   2                      TL0 = 0x65;    // ^^
  65   2                      TR0 = 1;       // switch on timer
  66   2              }
  67   1      }
  68          
  69          void wait_with_timer(unsigned int ms) {
  70   1              init_timer0();
  71   1              condTimerStatus = TIMER_STARTED;
  72   1              wait_ms_max = ms;
  73   1              wait_ms_current = 0;
  74   1      }
  75          
  76          void usleep100() {
  77   1              // Verbrät in etwa 100 Mikrosekunden
  78   1      
  79   1              int i = 0;
  80   1              while(i < 5)
  81   1                      i++;
  82   1              i++;
  83   1              i++;
  84   1              i++;
  85   1              i++;
  86   1      }
  87          
  88          void wait_100us(byte us) {
  89   1              // Verbrät in etwa us * 100 Mikrosekunden
  90   1              
  91   1              while (us--) {
  92   2                      int i = 0;
  93   2                      while(i < 4)
  94   2                              i++;
  95   2                      i++;
  96   2                      i++;
  97   2                      i++;
  98   2                      i++;
  99   2              }
 100   1      }
 101          
 102          void wait_ms(unsigned int ms) {
 103   1              // Verbrät in etwa ms Millisekunden
 104   1      
 105   1              for(; ms > 0; ms--) {
 106   2                      int i;
 107   2                      for (i = 0; i < 7; i++)
 108   2                              usleep100();
 109   2                      for (i = 0; i < 4; i++);
 110   2                      i++;
 111   2              }
 112   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    370    ----
C51 COMPILER V8.09   TIMING                                                                07/23/2009 15:03:50 PAGE 3   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
